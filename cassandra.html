<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;1.&nbsp;Cassandra Engine</title><link rel="stylesheet" type="text/css" href="stylesheet.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter" title="Chapter&nbsp;1.&nbsp;Cassandra Engine"><div class="titlepage"><div><div><h2 class="title"><a name="cassandra"></a>Chapter&nbsp;1.&nbsp;Cassandra Engine</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d374e4">Cassandra</a></span></dt><dd><dl><dt><span class="section"><a href="#d374e65">Maven Setup</a></span></dt><dt><span class="section"><a href="#d374e81">Dataset Format</a></span></dt><dt><span class="section"><a href="#d374e119">Getting Started</a></span></dt></dl></dd></dl></div><div class="section" title="Cassandra"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d374e4"></a>Cassandra</h2></div></div></div><p>
			<span class="application">Cassandra</span>
			is a BigTable data model running on an Amazon Dynamo-like
			infrastructure.
		</p><p>
			<span class="bold"><strong>NoSQLUnit</strong></span>
			supports
			<span class="emphasis"><em>Cassandra</em></span>
			by using next classes:
		</p><p>
			</p><table border="1" id="d374e22"><caption>Table&nbsp;1.1.&nbsp;Lifecycle Management Rules</caption><tr>
					<td>Embedded</td>

					<td>
						<code class="classname">com.lordofthejars.nosqlunit.cassandra.EmbeddedCassandra
						</code>
					</td>
				</tr><tr>
					<td>Managed</td>

					<td>
						<code class="classname">com.lordofthejars.nosqlunit.cassandra.ManagedCassandra
						</code>
					</td>
				</tr></table><p>
		</p><p>
			</p><table border="1" id="d374e50"><caption>Table&nbsp;1.2.&nbsp;Manager Rule</caption><tr>
					<td>NoSQLUnit Management</td>

					<td>
						<code class="classname">com.lordofthejars.nosqlunit.cassandra.CassandraRule
						</code>
					</td>
				</tr></table><p>
		</p><div class="section" title="Maven Setup"><div class="titlepage"><div><div><h3 class="title"><a name="d374e65"></a>Maven Setup</h3></div></div></div><p>
				To use
				<span class="bold"><strong>NoSQLUnit</strong></span>
				with
				<span class="application">Cassandra</span>
				you only need to add next
				dependency:
			</p><div class="example"><a name="conf.nosqlunit_cassandra_dep"></a><p class="title"><b>Example&nbsp;1.1.&nbsp;NoSqlUnit Maven Repository</b></p><div class="example-contents"><pre class="programlisting"><strong class="hl-tag" style="color: #000096">&lt;dependency&gt;</strong>
	<strong class="hl-tag" style="color: #000096">&lt;groupId&gt;</strong>com.lordofthejars<strong class="hl-tag" style="color: #000096">&lt;/groupId&gt;</strong>
	<strong class="hl-tag" style="color: #000096">&lt;artifactId&gt;</strong>nosqlunit-cassandra<strong class="hl-tag" style="color: #000096">&lt;/artifactId&gt;</strong>
	<strong class="hl-tag" style="color: #000096">&lt;version&gt;</strong>${version.nosqlunit}<strong class="hl-tag" style="color: #000096">&lt;/version&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/dependency&gt;</strong></pre></div></div><br class="example-break"></div><div class="section" title="Dataset Format"><div class="titlepage"><div><div><h3 class="title"><a name="d374e81"></a>Dataset Format</h3></div></div></div><p>
				Default dataset file format in
				<span class="emphasis"><em>Cassandra</em></span>
				module is json. To make compatible
				<span class="bold"><strong>NoSQLUnit</strong></span>
				with
				<span class="application">
					<a class="link" href="https://github.com/jsevellec/cassandra-unit/" target="_top">Cassandra-Unit</a>
				</span>
				file format,
				<code class="classname">DataLoader</code>
				of
				<span class="application">Cassandra-Unit</span>
				project is used, so same json format file is used.
			</p><p>
				Datasets must have next
				<a class="link" href="#ex.cassandra_dataset" title="Example&nbsp;1.2.&nbsp;Example of Casssandra Dataset">
					format
				</a>
				:
			</p><div class="example"><a name="ex.cassandra_dataset"></a><p class="title"><b>Example&nbsp;1.2.&nbsp;Example of Casssandra Dataset</b></p><div class="example-contents"><pre class="programlisting">{
    "name" : "",
    "replicationFactor" : "",
    "strategy" : "",
    "columnFamilies" : [{
        "name" : "",
        "type" : "",
        "keyType" : "",
        "comparatorType" : "",
        "subComparatorType" : "",
        "defaultColumnValueType" : "",
        "comment" : "",
        "compactionStrategy" : "",
        "compactionStrategyOptions" : [{
            "name" : "",
            "value": ""
        }],
        "gcGraceSeconds" : "",
        "maxCompactionThreshold" : "",
        "minCompactionThreshold" : "",
        "readRepairChance" : "",
        "replicationOnWrite" : "",
        "columnsMetadata" : [{
            "name" : "",
            "validationClass : "",
            "indexType" : "",
            "indexName" : ""
        },
        ...
        ]
        "rows" : [{
            "key" : "",
            "columns" : [{
                "name" : "",
                "value" : ""
            },
            ...
            ],
            ...
            // OR
            ...
            "superColumns" : [{
                "name" : "",
                "columns" : [{
                    "name" : "",
                    "value" : ""
                },
                ...
                ]
            },
            ...
            ]
        },
        ...
        ]
    },
    ...
    ]
}</pre></div></div><br class="example-break"><p>
				See
				<a class="link" href="https://github.com/jsevellec/cassandra-unit/wiki/What-can-you-set-into-a-dataSet" target="_top">Cassandra-Unit Dataset</a>
				format for more information.
			</p></div><div class="section" title="Getting Started"><div class="titlepage"><div><div><h3 class="title"><a name="d374e119"></a>Getting Started</h3></div></div></div><div class="section" title="Lifecycle Management Strategy"><div class="titlepage"><div><div><h4 class="title"><a name="d374e122"></a>Lifecycle Management Strategy</h4></div></div></div><p>
					First step is defining which lifecycle management strategy is
					required for your tests. Depending on kind of test you are
					implementing (unit test, integration test, deployment test, ...)
					you will require an embedded approach, managed approach or remote
					approach.
				</p><div class="section" title="Embedded Lifecycle"><div class="titlepage"><div><div><h5 class="title"><a name="d374e127"></a>Embedded Lifecycle</h5></div></div></div><p>
						To configure
						<span class="bold"><strong>embedded</strong></span>
						approach you should only instantiate next
						<a class="link" href="#program.cassandra_embedded_conf" title="Example&nbsp;1.3.&nbsp;Embedded Cassandra">rule</a>
						:
					</p><div class="example"><a name="program.cassandra_embedded_conf"></a><p class="title"><b>Example&nbsp;1.3.&nbsp;Embedded Cassandra</b></p><div class="example-contents"><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ClassRule</span></em>
<strong class="hl-keyword">public</strong> <strong class="hl-keyword">static</strong> EmbeddedCassandra embeddedCassandraRule = newEmbeddedCassandraRule().build();</pre></div></div><br class="example-break"><p>
						By default embedded
						<span class="emphasis"><em>Cassandra</em></span>
						rule uses next
						default values:
					</p><table id="d374e148"><caption>Table&nbsp;1.3.&nbsp;Default Embedded Values</caption><tr>
							<td>
								Target path
							</td>
							<td>
								This is the directory where
								<span class="emphasis"><em>Cassandra</em></span>
								server is started and is
								<code class="constant">target/cassandra-temp</code>
								.
							</td>
						</tr><tr>
							<td>
								Cassandra Configuration File
							</td>
							<td>
								Location of yaml configuration file. By default a
								configuration
								file is provided with correct default parameters.
							</td>
						</tr><tr>
							<td>
								Host
							</td>
							<td>
								localhost
							</td>
						</tr><tr>
							<td>
								Port
							</td>
							<td>
								By default port used is 9171. Port cannot be configured, and
								cannot be changed if you provide an alternative Cassandra
								Configuration File.
							</td>
						</tr></table></div><div class="section" title="Managed Lifecycle"><div class="titlepage"><div><div><h5 class="title"><a name="d374e189"></a>Managed Lifecycle</h5></div></div></div><p>
						To configure
						<span class="bold"><strong>managed</strong></span>
						approach you should only instantiate next
						<a class="link" href="#program.cassandra_managed_conf" title="Example&nbsp;1.4.&nbsp;Managed Cassandra">rule</a>
						:
					</p><div class="example"><a name="program.cassandra_managed_conf"></a><p class="title"><b>Example&nbsp;1.4.&nbsp;Managed Cassandra</b></p><div class="example-contents"><pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@ClassRule</span></em>
<strong class="hl-keyword">public</strong> <strong class="hl-keyword">static</strong> ManagedCassandra managedCassandra = newManagedCassandraRule().build();</pre></div></div><br class="example-break"><p>
						By default managed
						<span class="emphasis"><em>Cassandra</em></span>
						rule uses next
						default values but can be configured
						programmatically:
					</p><table id="d374e210"><caption>Table&nbsp;1.4.&nbsp;Default Managed Values</caption><tr>
							<td>
								Target path
							</td>
							<td>
								This is the directory where
								<span class="emphasis"><em>Cassandra</em></span>
								server is started and is
								<code class="constant">target/cassandra-temp</code>
								.
							</td>
						</tr><tr>
							<td>
								CassandraPath
							</td>
							<td>
								<span class="emphasis"><em>Cassandra</em></span>
								installation directory which by default is
								retrieved from
								<code class="varname">CASSANDRA_HOME</code>
								system environment
								variable.
							</td>
						</tr><tr>
							<td>
								Port
							</td>
							<td>
								By default port used is 9160. If port is changed in
								<span class="emphasis"><em>Cassandra</em></span>
								configuration file, this port should be configured too here.
							</td>
						</tr></table><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
						To start
						<span class="emphasis"><em>Cassandra</em></span><code class="varname">java.home</code>
						must be set. Normally this variable is already configured, you
						would need to do nothing.
					</div></div><div class="section" title="Remote Lifecycle"><div class="titlepage"><div><div><h5 class="title"><a name="d374e259"></a>Remote Lifecycle</h5></div></div></div><p>
						Configuring
						<span class="bold"><strong>remote</strong></span>
						approach
						does not require any special rule because you (or System
						like
						<span class="application">Maven</span>
						) is the responsible of starting and
						stopping the server. This mode
						is used in deployment tests where you
						are testing your application
						on real environment.
					</p></div></div><div class="section" title="Configuring Cassandra Connection"><div class="titlepage"><div><div><h4 class="title"><a name="d374e270"></a>Configuring Cassandra Connection</h4></div></div></div><p>
					Next step is configuring
					<span class="bold"><strong>Cassandra</strong></span>
					rule in charge of maintaining
					<span class="emphasis"><em>Cassandra</em></span>
					graph into known state by inserting and deleting defined
					datasets.
					You must register
					<code class="classname">CassandraRule</code>
					<span class="emphasis"><em>JUnit</em></span>
					rule class, which
					requires a configuration parameter with
					information like host,
					port, or cluster name.
				</p><p>To make developer's life easier and code more readable, a
					fluent
					interface can be used to create these configuration objects.
					Three
					different kind of configuration builders exist.
				</p><div class="section" title="Embedded Connection"><div class="titlepage"><div><div><h5 class="title"><a name="d374e289"></a>Embedded Connection</h5></div></div></div><p>
						The first one is for configuring a connection to embedded
						<span class="emphasis"><em>Cassandra</em></span>
						.
					</p><div class="example"><a name="program.embedded_connection_cassandra_parameters"></a><p class="title"><b>Example&nbsp;1.5.&nbsp;Cassandra with embedded configuration</b></p><div class="example-contents"><pre class="programlisting"><strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> com.lordofthejars.nosqlunit.cassandra.EmbeddedCassandraConfigurationBuilder.newEmbeddedCassandraConfiguration;

<em><span class="hl-annotation" style="color: gray">@Rule</span></em>
<strong class="hl-keyword">public</strong> CassandraRule cassandraRule = <strong class="hl-keyword">new</strong> CassandraRule(newEmbeddedCassandraConfiguration().clusterName(<strong class="hl-string"><em style="color:red">"Test Cluster"</em></strong>).build());</pre></div></div><br class="example-break"><p>
						Host and port parameters are already configured.
					</p></div><div class="section" title="Managed Connection"><div class="titlepage"><div><div><h5 class="title"><a name="d374e304"></a>Managed Connection</h5></div></div></div><p>
						The first one is for configuring a connection to managed
						<span class="emphasis"><em>Cassandra</em></span>
						.
					</p><div class="example"><a name="program.managed_connection_cassandra_parameters"></a><p class="title"><b>Example&nbsp;1.6.&nbsp;Cassandra with managed configuration</b></p><div class="example-contents"><pre class="programlisting"><strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> com.lordofthejars.nosqlunit.cassandra.ManagedCassandraConfigurationBuilder.newManagedCassandraConfiguration;

<em><span class="hl-annotation" style="color: gray">@Rule</span></em>
<strong class="hl-keyword">public</strong> CassandraRule cassandraRule = <strong class="hl-keyword">new</strong> CassandraRule(newManagedCassandraConfiguration().clusterName(<strong class="hl-string"><em style="color:red">"Test Cluster"</em></strong>).build());</pre></div></div><br class="example-break"><p>
						Host and port parameters are already configured with default
						parameters of managed lifecycle. If port is changed, this class
						provides a method to set it.
					</p></div><div class="section" title="Remote Connection"><div class="titlepage"><div><div><h5 class="title"><a name="d374e319"></a>Remote Connection</h5></div></div></div><p>
						Configuring a connection to remote
						<span class="emphasis"><em>Cassandra</em></span>
						.
					</p><div class="example"><a name="program.remote_connection_cassandra_parameters"></a><p class="title"><b>Example&nbsp;1.7.&nbsp;Cassandra with remote configuration</b></p><div class="example-contents"><pre class="programlisting"><strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> com.lordofthejars.nosqlunit.cassandra.RemoteCassandraConfigurationBuilder.newRemoteCassandraConfiguration;

<em><span class="hl-annotation" style="color: gray">@Rule</span></em>
<strong class="hl-keyword">public</strong> CassandraRule cassandraRule = <strong class="hl-keyword">new</strong> CassandraRule(newRemoteCassandraConfiguration().host(<strong class="hl-string"><em style="color:red">"192.168.1.1"</em></strong>).clusterName(<strong class="hl-string"><em style="color:red">"Test Cluster"</em></strong>).build());</pre></div></div><br class="example-break"><p>
						Port parameter is already configured with default parameter
						of managed lifecycle. If port is changed, this class provides a
						method to set it. Note that host parameter must be specified in
						this case.
					</p></div></div><div class="section" title="Verifying Data"><div class="titlepage"><div><div><h4 class="title"><a name="d374e334"></a>Verifying Data</h4></div></div></div><p>
					<code class="classname">@ShouldMatchDataSet</code>
					is also supported for
					<span class="emphasis"><em>Cassandra</em></span>
					data but we should keep in mind some considerations.
				</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
					In
					<span class="bold"><strong>NoSQLUnit</strong></span>
					, expectations can only be used over data, not over configuration
					parameters, so for example fields set in
					<a class="link" href="#ex.cassandra_dataset" title="Example&nbsp;1.2.&nbsp;Example of Casssandra Dataset">dataset</a>
					file like compactionStrategy, gcGraceSeconds or
					maxCompactionThreshold are not used.
					Maybe in future will be
					supported but for now only data (keyspace, columnfamilyname,
					columns, supercolumns, ...) are supported.
				</div></div><div class="section" title="Full Example"><div class="titlepage"><div><div><h4 class="title"><a name="d374e353"></a>Full Example</h4></div></div></div><p>
					To show how to use
					<span class="bold"><strong>NoSQLUnit</strong></span>
					with
					<span class="emphasis"><em>Cassandra</em></span>
					,
					we are going to create a
					very simple application.
				</p><p>
					<a class="link" href="#program.person_cassandra_manager" title="Example&nbsp;1.8.&nbsp;PersonCar cassandra with manager.">PersonManager</a>
					is the business class responsible of getting and updating person's
					car.
				</p><div class="example"><a name="program.person_cassandra_manager"></a><p class="title"><b>Example&nbsp;1.8.&nbsp;PersonCar cassandra with manager.</b></p><div class="example-contents"><pre class="programlisting"><strong class="hl-keyword">public</strong> <strong class="hl-keyword">class</strong> PersonManager {
	
	<strong class="hl-keyword">private</strong> ColumnFamilyTemplate&lt;String, String&gt; template;
	
	<strong class="hl-keyword">public</strong> PersonManager(String clusterName, String keyspaceName, String host) {
		Cluster cluster = HFactory.getOrCreateCluster(clusterName, host);
		Keyspace keyspace = HFactory.createKeyspace(keyspaceName, cluster);
		
        template = <strong class="hl-keyword">new</strong> ThriftColumnFamilyTemplate&lt;String, String&gt;(keyspace,
        		<strong class="hl-string"><em style="color:red">"personFamilyName"</em></strong>, 
                                                               StringSerializer.get(),        
                                                               StringSerializer.get());
		
	}
	
	<strong class="hl-keyword">public</strong> String getCarByPersonName(String name) {
		ColumnFamilyResult&lt;String, String&gt; queryColumns = template.queryColumns(name);
		<strong class="hl-keyword">return</strong> queryColumns.getString(<strong class="hl-string"><em style="color:red">"car"</em></strong>);
	}
	
	<strong class="hl-keyword">public</strong> <strong class="hl-keyword">void</strong> updateCarByPersonName(String name, String car) {
		ColumnFamilyUpdater&lt;String, String&gt; createUpdater = template.createUpdater(name);
		createUpdater.setString(<strong class="hl-string"><em style="color:red">"car"</em></strong>, car);
		
		template.update(createUpdater);
	}
	
}</pre></div></div><br class="example-break"><p>
					And now one unit test and one integration test is written:
				</p><p>
					For
					<a class="link" href="#program.person_cassandra_unit" title="Example&nbsp;1.9.&nbsp;Cassandra with embedded configuration">unit</a>
					test we are going to use embedded approach:
				</p><div class="example"><a name="program.person_cassandra_unit"></a><p class="title"><b>Example&nbsp;1.9.&nbsp;Cassandra with embedded configuration</b></p><div class="example-contents"><pre class="programlisting"><strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> org.junit.Assert.assertThat;
<strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> org.hamcrest.CoreMatchers.is;

<strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> com.lordofthejars.nosqlunit.cassandra.EmbeddedCassandra.EmbeddedCassandraRuleBuilder.newEmbeddedCassandraRule;
<strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> com.lordofthejars.nosqlunit.cassandra.EmbeddedCassandraConfigurationBuilder.newEmbeddedCassandraConfiguration;

<strong class="hl-keyword">import</strong> org.junit.ClassRule;
<strong class="hl-keyword">import</strong> org.junit.Rule;
<strong class="hl-keyword">import</strong> org.junit.Test;

<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.annotation.UsingDataSet;
<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.cassandra.CassandraRule;
<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.cassandra.EmbeddedCassandra;
<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.core.LoadStrategyEnum;

<strong class="hl-keyword">public</strong> <strong class="hl-keyword">class</strong> WhenPersonWantsToKnowItsCar {

	<em><span class="hl-annotation" style="color: gray">@ClassRule</span></em>
	<strong class="hl-keyword">public</strong> <strong class="hl-keyword">static</strong> EmbeddedCassandra embeddedCassandraRule = newEmbeddedCassandraRule().build();
	
	<em><span class="hl-annotation" style="color: gray">@Rule</span></em>
	<strong class="hl-keyword">public</strong> CassandraRule cassandraRule = <strong class="hl-keyword">new</strong> CassandraRule(newEmbeddedCassandraConfiguration().clusterName(<strong class="hl-string"><em style="color:red">"Test Cluster"</em></strong>).build());
	
	
	<em><span class="hl-annotation" style="color: gray">@Test</span></em>
	<em><span class="hl-annotation" style="color: gray">@UsingDataSet(locations="persons.json", loadStrategy=LoadStrategyEnum.CLEAN_INSERT)</span></em>
	<strong class="hl-keyword">public</strong> <strong class="hl-keyword">void</strong> car_should_be_returned() {
		
		PersonManager personManager = <strong class="hl-keyword">new</strong> PersonManager(<strong class="hl-string"><em style="color:red">"Test Cluster"</em></strong>, <strong class="hl-string"><em style="color:red">"persons"</em></strong>, <strong class="hl-string"><em style="color:red">"localhost:9171"</em></strong>);
		String car = personManager.getCarByPersonName(<strong class="hl-string"><em style="color:red">"mary"</em></strong>);
		
		assertThat(car, is(<strong class="hl-string"><em style="color:red">"ford"</em></strong>));
		
	}
	
}</pre></div></div><br class="example-break"><p>
					And as
					<a class="link" href="#program.person_cassandra_integration" title="Example&nbsp;1.10.&nbsp;Cassandra with managed configuration">integration test</a>
					, the managed one:
				</p><div class="example"><a name="program.person_cassandra_integration"></a><p class="title"><b>Example&nbsp;1.10.&nbsp;Cassandra with managed configuration</b></p><div class="example-contents"><pre class="programlisting"><strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> com.lordofthejars.nosqlunit.cassandra.ManagedCassandraConfigurationBuilder.newManagedCassandraConfiguration;
<strong class="hl-keyword">import</strong> <strong class="hl-keyword">static</strong> com.lordofthejars.nosqlunit.cassandra.ManagedCassandra.ManagedCassandraRuleBuilder.newManagedCassandraRule;

<strong class="hl-keyword">import</strong> org.junit.ClassRule;
<strong class="hl-keyword">import</strong> org.junit.Rule;
<strong class="hl-keyword">import</strong> org.junit.Test;

<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.annotation.ShouldMatchDataSet;
<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.annotation.UsingDataSet;
<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.cassandra.CassandraRule;
<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.cassandra.ManagedCassandra;
<strong class="hl-keyword">import</strong> com.lordofthejars.nosqlunit.core.LoadStrategyEnum;

<strong class="hl-keyword">public</strong> <strong class="hl-keyword">class</strong> WhenPersonWantsToUpdateItsCar {

	<strong class="hl-keyword">static</strong> {
		System.setProperty(<strong class="hl-string"><em style="color:red">"CASSANDRA_HOME"</em></strong>, <strong class="hl-string"><em style="color:red">"/opt/cassandra"</em></strong>);
	}
	
	<em><span class="hl-annotation" style="color: gray">@ClassRule</span></em>
	<strong class="hl-keyword">public</strong> <strong class="hl-keyword">static</strong> ManagedCassandra managedCassandra = newManagedCassandraRule().build();
	
	<em><span class="hl-annotation" style="color: gray">@Rule</span></em>
	<strong class="hl-keyword">public</strong> CassandraRule cassandraRule = <strong class="hl-keyword">new</strong> CassandraRule(newManagedCassandraConfiguration().clusterName(<strong class="hl-string"><em style="color:red">"Test Cluster"</em></strong>).build());
	
	<em><span class="hl-annotation" style="color: gray">@Test</span></em>
	<em><span class="hl-annotation" style="color: gray">@UsingDataSet(locations="persons.json", loadStrategy=LoadStrategyEnum.CLEAN_INSERT)</span></em>
	<em><span class="hl-annotation" style="color: gray">@ShouldMatchDataSet(location="expected-persons.json")</span></em>
	<strong class="hl-keyword">public</strong> <strong class="hl-keyword">void</strong> new_car_should_be_updated() {
		
		PersonManager personManager = <strong class="hl-keyword">new</strong> PersonManager(<strong class="hl-string"><em style="color:red">"Test Cluster"</em></strong>, <strong class="hl-string"><em style="color:red">"persons"</em></strong>, <strong class="hl-string"><em style="color:red">"localhost:9171"</em></strong>);
		personManager.updateCarByPersonName(<strong class="hl-string"><em style="color:red">"john"</em></strong>, <strong class="hl-string"><em style="color:red">"opel"</em></strong>);
		
	}
	
}</pre></div></div><br class="example-break"><p>Note that in both cases we are using the same dataset as
					initial state, which looks like:
				</p><div class="example"><a name="program.expected_cassandra_file"></a><p class="title"><b>Example&nbsp;1.11.&nbsp;persons.json Cassandra file</b></p><div class="example-contents"><pre class="programlisting">{
    "name" : "persons",
    "columnFamilies" : [{
        "name" : "personFamilyName",
	"keyType" : "UTF8Type",
	"defaultColumnValueType" : "UTF8Type",
	"comparatorType" : "UTF8Type",
        "rows" : [{
            "key" : "john",
            "columns" : [{
                "name" : "age",
                "value" : "22"
            },
            {
                "name" : "car",
                "value" : "toyota"
            }]
        },
        {
            "key" : "mary",
            "columns" : [{
                "name" : "age",
                "value" : "33"
            },
            {
                "name" : "car",
                "value" : "ford"
            }]
        }]
    }]
}</pre></div></div><br class="example-break"></div></div></div></div></body></html>